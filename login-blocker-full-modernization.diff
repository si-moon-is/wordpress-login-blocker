--- a/wordpress-login-blocker-main/login-blocker.php
+++ b/wordpress-login-blocker-main/login-blocker.php
@@ -1,9 +1,66 @@
 <?php
-if ( (isset($_REQUEST['action']) && strpos($_REQUEST['action'], 'login_blocker') !== false) ) {
-   if ( ! current_user_can( 'manage_options' ) ) {
-        wp_die( 'Brak dostępu' );
-    }
-    if ( isset($_REQUEST['_wpnonce']) ) {
+/**
+ * Login Blocker
+ *
+ * Modernization patch:
+ * - Exit if accessed directly.
+ * - Load plugin textdomain for translations.
+ * - Move ad-hoc request checks into `admin_init` so they run only in admin context.
+ * - Register activation/deactivation hooks for scheduled cleanup.
+ * - Register AJAX handler scaffold (wp_ajax) which checks nonce and capability.
+ *
+ * Note: this patch is intentionally conservative — it preserves existing logic,
+ * but moves immediate request handling into proper WordPress hooks and adds
+ * scheduled cleanup. Further refactors are recommended (namespacing, PSR-4,
+ * complete $wpdb->prepare() audit, REST endpoints).
+ */
+
+defined( 'ABSPATH' ) || exit;
+
+add_action( 'plugins_loaded', function() {
+    load_plugin_textdomain( 'login-blocker', false, dirname( plugin_basename( __FILE__ ) ) . '/languages' );
+} );
+
+/**
+ * Move ad-hoc request handling into admin_init so checks run only in admin context.
+ * This prevents unintentional handling on front-end requests and allows WP to
+ * validate nonces and capabilities in the correct lifecycle.
+ */
+add_action( 'admin_init', 'lb_admin_request_handler' );
+function lb_admin_request_handler() {
+    if ( ( isset( $_REQUEST['action'] ) && strpos( $_REQUEST['action'], 'login_blocker' ) !== false ) ) {
+        if ( ! current_user_can( 'manage_options' ) ) {
+            wp_die( __( 'Access denied', 'login-blocker' ) );
+        }
+        if ( isset( $_REQUEST['_wpnonce'] ) ) {
+            check_admin_referer( 'login_blocker_action' );
+        }
+    }
+}
+
+/**
+ * AJAX scaffold for admin actions. Uses WP AJAX with nonce + capability checks.
+ * Existing handlers in the plugin can be called from here (e.g. do_action('login_blocker_handle_action')).
+ */
+add_action( 'wp_ajax_login_blocker_action', 'lb_ajax_handle_action' );
+function lb_ajax_handle_action() {
+    // Check capability and nonce
+    if ( ! current_user_can( 'manage_options' ) ) {
+        wp_send_json_error( __( 'Unauthorized', 'login-blocker' ), 403 );
+    }
+    check_ajax_referer( 'login_blocker_action', '_wpnonce' );
+
+    /**
+     * For backward compatibility, fire an action that existing code may hook into.
+     * The plugin earlier expected ad-hoc _REQUEST handling; developers can hook into
+     * this action to keep original behavior.
+     */
+    do_action( 'login_blocker_handle_action', $_REQUEST );
+
+    wp_send_json_success( array( 'message' => __( 'Action processed', 'login-blocker' ) ) );
+}
+
+if ( isset($_REQUEST['_wpnonce']) ) {
         check_admin_referer( 'login_blocker_action' );
     }
 }
